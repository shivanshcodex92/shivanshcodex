<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Shivanshcodex</title>

<style>
*{box-sizing:border-box;font-family:system-ui}
body{
margin:0;
height:100vh;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:#fff;
display:flex;
flex-direction:column;
}
header{
padding:14px 16px;
background:#1f3b44;
display:flex;
justify-content:space-between;
align-items:center;
}
header h1{margin:0;font-size:22px}
header span{font-size:13px;color:#9fd3c7}
header button{
background:#25d366;
border:none;
padding:8px 14px;
border-radius:14px;
font-weight:600;
cursor:pointer;
}

#loginBox{
flex:1;
display:flex;
align-items:center;
justify-content:center;
}
.login-card{
width:90%;
max-width:360px;
background:rgba(0,0,0,.45);
padding:24px;
border-radius:18px;
}
.login-card h2{margin-top:0}
input{
width:100%;
padding:14px;
border-radius:12px;
border:none;
margin-bottom:12px;
font-size:15px;
}
.btn-row{display:flex;gap:10px}
.btn{
flex:1;
padding:12px;
border:none;
border-radius:14px;
background:#25d366;
font-weight:600;
cursor:pointer;
}
.tip{text-align:center;font-size:13px;color:#b5d9d3;margin-top:10px}

#chatUI{
display:none;
flex:1;
}
.chat-area{
flex:1;
padding:14px;
overflow-y:auto;
}
.msg{
max-width:70%;
padding:10px 14px;
margin-bottom:10px;
border-radius:14px;
font-size:14px;
}
.me{background:#25d366;color:#000;margin-left:auto}
.other{background:#2a4b55}

.input-bar{
display:flex;
padding:10px;
background:#1f3b44;
}
.input-bar input{
flex:1;
border-radius:20px;
padding:12px;
border:none;
}
.send{
margin-left:8px;
width:46px;
height:46px;
border-radius:50%;
border:none;
background:#25d366;
font-size:18px;
cursor:pointer;
}
</style>
</head>

<body>

<header>
<div>
<h1>Shivanshcodex</h1>
<span>WhatsApp-like chat</span>
</div>
<button id="logoutBtn" style="display:none">Logout</button>
</header>

<!-- LOGIN -->
<div id="loginBox">
<div class="login-card">
<h2>Login</h2>
<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">
<div class="btn-row">
<button class="btn" id="loginBtn">Login</button>
<button class="btn" id="signupBtn">Create</button>
</div>
<div class="tip">2 browsers / incognito me test karo</div>
</div>
</div>

<!-- CHAT -->
<div id="chatUI">
<div class="chat-area" id="messages"></div>
<div class="input-bar">
<input id="msgInput" placeholder="Message">
<button class="send" id="sendBtn">âž¤</button>
</div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyDS6wdYNG2Q7ZUNPjUXdOn-Sqb3cLC4NgQ",
authDomain: "shivanshcodex-5fa03.firebaseapp.com",
projectId: "shivanshcodex-5fa03",
storageBucket: "shivanshcodex-5fa03.firebasestorage.app",
messagingSenderId: "160989825267",
appId: "1:160989825267:web:891e3ac888a46df3920f86"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginBox = document.getElementById("loginBox");
const chatUI = document.getElementById("chatUI");
const logoutBtn = document.getElementById("logoutBtn");

function fakeEmail(u){return u+"@shivansh.chat"}

document.getElementById("signupBtn").onclick = async()=>{
const u=username.value.trim(), p=password.value;
if(!u||!p) return alert("Fill all");
await createUserWithEmailAndPassword(auth,fakeEmail(u),p);
}

document.getElementById("loginBtn").onclick = async()=>{
const u=username.value.trim(), p=password.value;
await signInWithEmailAndPassword(auth,fakeEmail(u),p);
}

logoutBtn.onclick=()=>signOut(auth);

onAuthStateChanged(auth,user=>{
if(user){
loginBox.style.display="none";
chatUI.style.display="flex";
logoutBtn.style.display="block";
loadMessages();
}else{
loginBox.style.display="flex";
chatUI.style.display="none";
logoutBtn.style.display="none";
}
});

async function loadMessages(){
const q=query(collection(db,"messages"),orderBy("time"));
onSnapshot(q,snap=>{
messages.innerHTML="";
snap.forEach(d=>{
const m=d.data();
const div=document.createElement("div");
div.className="msg "+(m.uid===auth.currentUser.uid?"me":"other");
div.textContent=m.text;
messages.appendChild(div);
messages.scrollTop=messages.scrollHeight;
});
});
}

sendBtn.onclick=async()=>{
if(!msgInput.value)return;
await addDoc(collection(db,"messages"),{
text:msgInput.value,
uid:auth.currentUser.uid,
time:serverTimestamp()
});
msgInput.value="";
};
</script>

</body>
</html>
