<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Shivanshcodex</title>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;}
html,body{height:100%;margin:0;}

/* ✅ LOGIN PAGE SCROLL OFF */
body.locked{
overflow:hidden;
}

/* ✅ LIVE COLORFUL BACKGROUND (3 colors aesthetic) */
body{
color:#fff;
background:
radial-gradient(circle at 15% 20%, rgba(37,211,102,.35), transparent 40%),
radial-gradient(circle at 80% 30%, rgba(0,195,255,.30), transparent 45%),
radial-gradient(circle at 50% 85%, rgba(255,0,150,.22), transparent 50%),
linear-gradient(135deg, #071a22, #0b2a33, #071a22);
background-size:200% 200%;
animation:bgPulse 10s ease-in-out infinite;
display:flex;
flex-direction:column;
}

@keyframes bgPulse{
0%{background-position:0% 50%}
50%{background-position:100% 50%}
100%{background-position:0% 50%}
}

/* HEADER */
header{
padding:16px 16px 10px;
background:rgba(0,0,0,.22);
backdrop-filter:blur(12px);
display:flex;
justify-content:space-between;
align-items:center;
}
header h1{margin:0;font-size:24px}
header span{font-size:13px;color:#bde5dc}
header button{
background:#25d366;border:none;padding:10px 18px;border-radius:20px;
font-weight:700;cursor:pointer;
box-shadow:0 8px 20px rgba(37,211,102,.35);
transition:.18s;
}
header button:active{transform:scale(.95)}

/* ✅ LOGIN WRAPPER FIXED CENTER */
#loginBox{
position:fixed;
inset:0;
display:flex;
align-items:center;
justify-content:center;
padding:18px;
}

/* FLOATING GLASS CARD */
.login-card{
width:100%;
max-width:380px;
background:rgba(255,255,255,.08);
backdrop-filter:blur(18px);
border:1px solid rgba(255,255,255,.10);
border-radius:22px;
padding:26px 22px;
box-shadow:0 30px 70px rgba(0,0,0,.45);
animation:float 4s ease-in-out infinite;
}

@keyframes float{
0%,100%{transform:translateY(0)}
50%{transform:translateY(-8px)}
}

.login-card h2{
margin:0 0 18px;
font-size:28px;
text-align:center;
letter-spacing:.3px;
}

/* INPUTS */
input{
width:100%;
padding:16px;
border-radius:16px;
border:none;
margin-bottom:14px;
font-size:15px;
background:rgba(255,255,255,.92);
outline:none;
}

/* BUTTONS */
.btn-row{display:flex;gap:12px;margin-top:6px;}
.btn{
flex:1;
padding:14px;
border:none;
border-radius:22px;
background:#25d366;
color:#031b10;
font-weight:800;
cursor:pointer;
box-shadow:0 10px 25px rgba(37,211,102,.40);
transition:.18s;
}
.btn:active{transform:scale(.96);}

.tip{
margin-top:14px;
text-align:center;
font-size:13px;
color:#d0f1ea;
opacity:.9;
}

/* CHAT UI */
#chatUI{
display:none;
flex:1;
flex-direction:column;
}
.chat-area{flex:1;padding:16px;overflow-y:auto;}
.msg{
max-width:72%;
padding:12px 16px;
margin-bottom:10px;
border-radius:18px;
font-size:14px;line-height:1.4;
}
.me{background:#25d366;color:#000;margin-left:auto;}
.other{background:rgba(255,255,255,.15);}

.input-bar{
display:flex;
padding:12px;
background:rgba(0,0,0,.30);
backdrop-filter:blur(10px);
}
.input-bar input{flex:1;border-radius:22px;padding:14px;border:none;}
.send{
margin-left:8px;
width:50px;height:50px;
border-radius:50%;
border:none;
background:#25d366;
font-size:18px;
cursor:pointer;
box-shadow:0 8px 20px rgba(37,211,102,.45);
transition:.18s;
}
.send:active{transform:scale(.95);}
</style>
</head>

<body class="locked">

<header>
<div>
<h1>Shivanshcodex</h1>
<span>WhatsApp-like chat</span>
</div>
<button id="logoutBtn" style="display:none">Logout</button>
</header>

<!-- LOGIN -->
<div id="loginBox">
  <div class="login-card">
    <h2>Login</h2>
    <input id="username" placeholder="username">
    <input id="password" type="password" placeholder="password">

    <div class="btn-row">
      <button class="btn" id="loginBtn">Login</button>
      <button class="btn" id="signupBtn">Create</button>
    </div>

    <div class="tip">2 browsers / incognito me test karo</div>
  </div>
</div>

<!-- CHAT -->
<div id="chatUI">
  <div class="chat-area" id="messages"></div>
  <div class="input-bar">
    <input id="msgInput" placeholder="Message">
    <button class="send" id="sendBtn">➤</button>
  </div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDS6wdYNG2Q7ZUNPjUXdOn-Sqb3cLC4NgQ",
  authDomain: "shivanshcodex-5fa03.firebaseapp.com",
  projectId: "shivanshcodex-5fa03",
  storageBucket: "shivanshcodex-5fa03.firebasestorage.app",
  messagingSenderId: "160989825267",
  appId: "1:160989825267:web:891e3ac888a46df3920f86"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginBox=document.getElementById("loginBox");
const chatUI=document.getElementById("chatUI");
const logoutBtn=document.getElementById("logoutBtn");

const fakeEmail=u=>u+"@shivansh.chat";

signupBtn.onclick=()=>createUserWithEmailAndPassword(auth,fakeEmail(username.value),password.value);
loginBtn.onclick=()=>signInWithEmailAndPassword(auth,fakeEmail(username.value),password.value);
logoutBtn.onclick=()=>signOut(auth);

onAuthStateChanged(auth,user=>{
  loginBox.style.display=user?"none":"flex";
  chatUI.style.display=user?"flex":"none";
  logoutBtn.style.display=user?"block":"none";
  document.body.classList.toggle("locked", !user); // ✅ login pe scroll off

  if(user) loadMessages();
});

function loadMessages(){
  const q=query(collection(db,"messages"),orderBy("time"));
  onSnapshot(q,s=>{
    messages.innerHTML="";
    s.forEach(d=>{
      const m=d.data();
      const div=document.createElement("div");
      div.className="msg "+(m.uid===auth.currentUser.uid?"me":"other");
      div.textContent=m.text;
      messages.appendChild(div);
      messages.scrollTop=messages.scrollHeight;
    });
  });
}

sendBtn.onclick=async()=>{
  if(!msgInput.value)return;
  await addDoc(collection(db,"messages"),{
    text:msgInput.value,
    uid:auth.currentUser.uid,
    time:serverTimestamp()
  });
  msgInput.value="";
};
</script>

</body>
</html>
